# 前座

## 身の回りにあるネットワーク（インターネット）

- パソコン（有線、Wi-Fi）
- スマホ（Wi-Fi、モバイルネットワーク）
- ゲーム機（Wi-Fi）
- 家電（Wi-Fi、モバイルネットワーク）
- 時計（Bluetooth）
- 自動車、重機（モバイルネットワーク）

## 製品にあるネットワーク

- LabSolutions
- LabTotal
- LC, LCMS, (GC)

ネットワークは現代社会において、無くて成らない存在

## ネットワークはどのように成り立っているか

- 前述のようにデバイスは様々な通信方法（経路）でつながっている
- 方法ごとに違う決まりで通信していては大変
- ネットワーク通信が円滑に行われるよう、
  - 通信過程を階層として考える概念が標準化されている
  - 階層ごとに様々な **プロトコル** が定義されている
  - ソフトウェア、ミドルウェア、ハードウェアは自分が該当する層に適するプロトコルを実装する
  - 各層は上位/下位の違いを意識しないで済む

<img src="1.17.png" style="width: 400px;">
無線機ではなくて携帯電話のほうがよい（無線は一方向通信なので）
[図1.17]

# ネットワークのプロトコル

- どんな層に役割を分けたらよいか
- どんなプロトコルで通信したらよいか

役割分担のモデルとして **OSI参照モデル** が提唱された

## OSI参照モデル

- Open Systems Interconnection
- ソフトウェア/OS/端末/通信経路など、階層化された **役割** のモデル
- 国際標準化機構（ISO）によって標準化された
- 世の中の通信機器やプロトコルはこのモデルに基づいて設計・実装されている
- あくまでモデルであり、これに100%忠実に従う必要はない

<img src="1.19.png" style="width: 400px;">

[図1.19]

## 各層のプロトコルのいろいろな実装

<img src="2.8.png" style="width: 400px;">
[図2.8]

## 右側の分類は一体何？

- **TCP/IPモデル**  
  とは
    - 現代で **現実的に広く普及している** ネットワーク階層のモデル  
      またはそのモデルを構成するプロトコル群を指す

    - 「DARPAモデル」「インターネット・プロトコル・スイート」などとも呼ばれる  

      DARPA: アメリカ国防高等研究計画局

- TCP/IPモデルは、OSI参照モデルと同様にISOで標準化されている

- 下図ではOSIと対で表現されているが，この表現をIETFは否定している[要出典]

  IETF: Internet Engineering Task Force

<img src="2.8.png" style="width: 400px;">
[図2.8]

## なぜTCP/IPが使われるようになった？

- TCP/IPはプロトコル群が基本的にオープンだった  
  他の実装はベンダー固有だったり、ライセンスが必要だったりした
  （プロプライエタリ・ソフトウェアと呼ばれる）
- TCP/IPモデルはOSI参照モデルよりも、より実用に即したモデルだった

上記の要因から、他のプロトコルよりも爆発的に普及して今日に至る

## TCP/IPでのデータの扱い

- 「パケット」という単位でデータを扱う
  - 元のデータを決まった長さで細切れにしたもの
  - パケ代の「パケ」はこのパケットと同じ
  - DARPAが開発したARPANET（インターネットの原型）がこのパケット方式を導入した
- パケットは「データ」と「ヘッダー」で構成される
- データはパケットに分割され、各層で専用のヘッダーがパケットに付加されてゆく

<img src="2.17-0.png" style="width: 800px;">
[図2.17]

## TCP/IPでのデータの流れ

各層でなぜそんなにヘッダーをつけなければならないか。

​	それぞれの層で必要な情報を付加している。

​	各層のごとに「データの整合性の検証」や「パケットの順番の整理」などの役割が分かれている

​	送信・受信時に各層が間違った処理を行わないよう，それぞれ必要な情報をヘッダーで付加している

# 各層がどのような役割を持っているか，下図を説明する前にさらっと入れたほうがよい

- 設計原則の概念も交えながら…
  - テーマの本題ではないが，大事な話
  - 以前の勉強会のネタを掘り返して話す

<img src="2.18.png" style="width: 400px;">
[図2.18]

# TCP/IP のモデルにおける各層の役割

## アプリケーション層 (2.4.6)

- アプリケーション同士がやり取りする層  

    - 具体的なサービス，データの表現方法，プログラムの通信開始から終了までの手順などを提供する。

    - 特定のアプリ同士、独自のプロトコルを使うことも多い  

      LabSolutions はこのアプリケーション層を作りこんでいる

- TCP/IPで標準化されている共通プロトコルもたくさんある

    - FTP（ファイル転送）, HTTP（Web）, IMAP（Eメール）

<img src="2.11.png" style="width: 400px;">
[図2.11]

# トランスポート層 (TCP)

## TCPの役割

- 通信をするには、お互いに協調したやり取りをする必要がある
  - おはようございます課長！
  - おはようTさん、今日も元気そうだね。
  - はい！ところでこれ、この前から頼まれてた資料です。
  - おお、どれどれ…うん、なかなかよく纏まってるね。
    これをベースに顧客向け資料を作らせてもらうよ。
  - よろしくお願いします！
  - ところで早速悪いけど、時間が空いたようだしこの実験の検証をお願いできるかな。
  - わかりました。…一寸分量があるので、見積もります。またお伺いしますね。
  - ありがとう、よろしくね。

## トランスポート層 解説

https://www.slideshare.net/sasakipochi/tcp-80894969

- TCPが実現していること / それを省いたUDPの特徴と双方の利点や使われるべき場面を比較しながら説明したほうがよい。
- ヘッダーの構造も交えながら説明
- アプリケーションはTCPがパケットの整列や検証などをやってくれるおかげでそのあたりを気にする必要がない。

# ネットワーク層 (IP)

## IPの役割

- トランスポート層では，ノード同士が協調した通信を行う方法を提供した

- ネットワーク層は **終端ノード間（End-to-End）の通信そのものを提供する**

  下記の要素でコンピューター同士が通信できるようになる

  - IPアドレスを提供する

  - パケットを配達（ルーティング）する

    ネットワークの図をバンと出して，その中を最適な経路で通る仕組みを提供している

  - パケットの分割、再構築をする

- このおかげで，TCPはどんな経路を通る必要があるかを考える必要がない

## IPアドレスとは

- ノード（ホスト）を識別するための値
- IPv4は32bit、IPv6は128bitの2進数で表される

| 172.      | 31.       | 1.        | 3         |
| --------- | --------- | --------- | --------- |
| 1010 1100 | 0001 1111 | 0000 0001 | 0000 0011 |

## IPアドレスの構成

- 一つのIPアドレスで「ネットワーク」と「ホスト」の二つの場所を表す
  「ネットワーク部」と「ホスト部」で構成される

<img src="4.11.png" style="width: 400px;">
[図4.11]

## IPアドレスのクラス

- ネットワーク部とホスト部の配分を決めるクラスA ~ Dまでの分類が存在 **した** 。

<img src="4.13.png" style="width: 400px;">
[図4.13]

- 現在は概念としては残っているが、いくつかの問題から今は **CIDR** という方法でネットワーク部とホスト部を分けている。

## クラスによる分類の問題

- クラスによってそのネットワークに接続できるノード数が決まる
  - クラスA: 16,777,214
  - クラスB: 65,534
  - クラスC: 254
- 各クラスで台数が異なりすぎて、柔軟なネットワーク構成ができない
- 「サブネットマスク」を導入して、柔軟性を上げた

## クラスの説明は省いてもよい

## IPアドレスのサブネットマスク

- IPアドレスの設定で「255…」と入力するやつ
- ネットワーク部とホスト部の切れ目を表すための値
  - 1bitずつ分けれるようにすることで柔軟性が上がった
- 32bit（または128bit）の値を任意のbit数で区切るため、下記の書き方をする
  x.x.x.x/y ← yの部分がサブネットマスク（0 - 32）
  - CIDR (Classless InterDomain Routing)形式と呼ばれる、経路制御の考え方

<img src="4.17.png" style="width: 400px;">
[図4.17]

## グローバルIP/プライベートIPの違い

## 異なるサブネット同士の通信に必要なこと

- ルーティングで重要なのはゲートウェイとルーティングテーブル

## ルーティング

<img src="4.23.png" style="width: 400px;">
[図4.23]

## パケットの分割、再構築

- ネットワーク層の一つ上の層（データリンク層）で転送可能な最大サイズ（MTU）に収まるよう、パケットを分割する

<img src="4.24.png" style="width: 400px;">
[図4.24]

## パケットの分割について気をつけなければならない場面

- インターネットなどを経由する場合、パケットが大きく断片化することがある
  - 経路は自分で選べないため、途中で小さいMTUの経路を通過する可能性がある
    - MTUが小さいと
      TCPで分割されていたパケットがIPで更に分割されてしまう
      分割/再構築処理が過多になる
      パケットの中でヘッダの占める割合が大きくなる
      →結果的に狭帯域環境に追いやられる
  - 当初は想定していなかった通信障害が発生したり、システムが不安定になるなどのリスクが高まる
- 最近のOSは大きなMTUをとる経路を探索するアルゴリズムが実装されている
  最初は遅かった通信が、しばらくたつと速くなる挙動を示す
- LabSolutions（ロケット社）であった実例を紹介する

# データリンク層

＿人人人人人人人人人＿
＞　時間がたりない　＜
￣Y^Y^Y^Y^Y^Y^Y^Y￣

# おまけ

## DNS

## 他に製品問い合わせなどであった実例を紹介する

# 参考文献等

1. マスタリング TCP/IP 入門編 第5版, 竹下隆史 他, オーム社

2. 基礎からわかる TCP/IP ネットワーク実験プログラミング 第2版, 村山公保, オーム社

3. https://www.slideshare.net/sasakipochi, 株式会社DMMラボ 佐々木健氏




# 危ない用語・ツッコミポイント

- [プロトコル](http://ja.wikipedia.org/wiki/プロトコル)
- ソフトの設計で必要な知識と絡めて話す！！
  - こんな美しい設計思想があるからこそ，インフラ然として成り立っているんだよ！！
  - 設計大事！！

